<div id="tournament-detail" class="container">
  <ol class="breadcrumb ssk-breadcrumb">
    <li class="breadcrumb-item"><a class="ssk-link" ui-sref="tournament">Tournaments</a></li>
    <li class="breadcrumb-item active" ng-bind="$ctrl.tournament.name"></li>
  </ol>

  <div class="ssk-flex-end padding-bottom">
    <button ng-if="!$ctrl.editMode" class="btn ssk-btn-danger" type="button"
            ng-click="$ctrl.enableEditMode()">
      Edit
    </button>
    <button ng-if="$ctrl.editMode" class="btn ssk-btn-primary" type="button"
            ng-click="$ctrl.recalcMatches()" ng-disabled="$ctrl.recalcingMatches">
      Recalc Scores
      <i ng-if="$ctrl.recalcingMatches" class="fa fa-spinner fa-spin"></i>
    </button>
  </div>

  <div class="panel ssk-panel">
    <div class="panel-heading ssk-flex-space-between">
      <span class="ssk-text-large padding-left">Players</span>
      <a class="ssk-link" ui-sref="add-player({ tournamentId: $ctrl.tournamentId })">
        Add Players
      </a>
    </div>
    <div class="panel-body">
      <table class="table ssk-table">
        <thead>
        <th>Rank</th>
        <th>Name</th>
        <th>Score</th>
        <th>Note</th>
        </thead>
        <tbody>
        <tr ng-if="$ctrl.playersInfoLoaded" ng-click="$ctrl.showPlayerInfo(tournamentPlayer)" class="ssk-table-link"
            ng-repeat="tournamentPlayer in $ctrl.tournamentPlayers | orderBy: 'score':true ">
          <td ng-bind="$index + 1"></td>
          <td ng-bind="tournamentPlayer.name"></td>
          <td ng-bind="tournamentPlayer.score"></td>
          <td ng-bind="$ctrl.getNote($ctrl.notesByTournamentPlayerId[tournamentPlayer._id])"></td>
        </tr>
        <tr ng-if="!$ctrl.playersInfoLoaded">
          <td colspan="100%" class="text-center">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="panel ssk-panel">
    <div class="panel-heading ssk-flex-space-between">
      <span class="ssk-text-large padding-left">Matches</span>
      <a ng-show="!$ctrl.addMatching" class="ssk-link" ng-click="$ctrl.addMatch()">
        Add Matches
      </a>
    </div>
    <div class="panel-body">
      <div class="row padding-bottom" ng-if="$ctrl.addMatching">
        <div class="col-xs-5">
          <div class="input-group player-input-group">
            <span class="input-group-addon">
              <i class="fa fa-trophy" aria-hidden="true"></i>
              <div ng-bind="'+' + $ctrl.calculateScoreForWinner($ctrl.matchPlayer1, $ctrl.matchPlayer2)"></div>
            </span>
            <input type="text" ng-model="$ctrl.matchPlayer1" class="form-control player-input"
                   uib-typeahead="player as player.name for player in $ctrl.tournamentPlayers | filter:$viewValue | limitTo:8"
                   placeholder="Match Winner...">
          </div>
        </div>
        <div class="col-xs-5">
          <div class="input-group player-input-group">
            <span class="input-group-addon">
              <i class="fa fa-thumbs-o-down" aria-hidden="true"></i>
              <div ng-bind="$ctrl.calculateScoreForLoser($ctrl.matchPlayer1, $ctrl.matchPlayer2) || '-'"></div>
            </span>
            <input type="text" ng-model="$ctrl.matchPlayer2" class="form-control player-input"
                   uib-typeahead="player as player.name for player in $ctrl.tournamentPlayers | filter:$viewValue | limitTo:8"
                   placeholder="Match Contender...">
          </div>
        </div>
          <button class="btn btn-default"
                type="submit"
                ng-disabled="(!$ctrl.playersById[$ctrl.matchPlayer1.playerId] || !$ctrl.playersById[$ctrl.matchPlayer2.playerId]) || $ctrl.playersById[$ctrl.matchPlayer1.playerId] == $ctrl.playersById[$ctrl.matchPlayer2.playerId]"
                ng-click="$ctrl.saveMatch($ctrl.matchPlayer1, $ctrl.matchPlayer2)">
          Save
        </button>
        <a class="ssk-link padding-left" ng-click="$ctrl.cancelMatch()">
          Cancel
        </a>
      </div>
      <table class="table ssk-table">
        <thead>
        <th>Match</th>
        <th>Players</th>
        <th colspan="2">Score</th>
        <th>Date</th>
        </thead>
        <tbody>
        <tr ng-if="!$ctrl.matches">
          <td colspan="100%" class="text-center">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
          </td>
        </tr>
        <tr ng-if="$ctrl.matches.length === 0">
          <td colspan="100%">No matches played.</td>
        </tr>
        <tr ng-repeat="match in $ctrl.pagedMatches">
          <td ng-bind="$ctrl.matches.length - ($ctrl.paging.currentPage * 10) - $index"></td>
          <td>
            <i class="fa fa-trophy" aria-hidden="true"></i>
            <span ng-bind="$ctrl.tournamentPlayersById[match['match-results'][0].tournamentPlayerId].name"></span>
            <span class="ssk-text-light">vs.</span>
            <span class="ssk-text-light" ng-bind="$ctrl.tournamentPlayersById[match['match-results'][1].tournamentPlayerId].name"></span>
          </td>
          <td>
            <strong>
              +<span ng-bind="match['match-results'][0].scoreDelta"></span>
            </strong>
          </td>
          <td><span ng-bind="match['match-results'][1].scoreDelta"></span></td>
          <td class="ssk-text-light" ng-bind="match.createdAt | date:'mediumDate'"></td>
        </tr>
        </tbody>
      </table>
      <div class="text-center" ng-if="!$ctrl.matches">
        <ul class="pagination">
          <li ng-repeat="page in $ctrl.paging.pages">
            <a class="btn-primary" ng-bind="page + 1"
               ng-class="{'active': page === $ctrl.paging.currentPage, 'cursor': page != $ctrl.paging.currentPage}"
               ng-click="$ctrl.getPagedMatches($ctrl.matches, $ctrl.paging, page)"></a>
          </li>
        </ul>
      </div>
    </div>
  </div>

</div>
